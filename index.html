<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Переход...</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle at top left, #0a1930, #111d4a, #2a5298);
    color: #fff;
    font-family: "Poppins", sans-serif;
    overflow: hidden;
  }
  h1 {
    font-size: 2.5em;
    animation: glow 3s ease-in-out infinite alternate;
  }
  @keyframes glow {
    from { text-shadow: 0 0 10px #00c3ff, 0 0 20px #0077ff; }
    to { text-shadow: 0 0 25px #66e0ff, 0 0 50px #00aaff; }
  }
  p {
    opacity: 0.85;
    margin-top: 10px;
  }
  .loader {
    margin-top: 30px;
    border: 5px solid rgba(255,255,255,0.2);
    border-top: 5px solid #00bfff;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .error {
    color: #ff6b6b;
    text-shadow: 0 0 10px rgba(255,50,50,0.7);
  }
</style>
</head>
<body>
  <h1 id="status">Подключение...</h1>
  <p id="info">Проверяем доступность сервера</p>
  <div class="loader"></div>

  <script>
    async function checkAndRedirect() {
      try {
        const res = await fetch('target.json');
        const data = await res.json();
        if (!data.url) throw new Error("URL не найден");

        const targetUrl = data.url;
        document.getElementById("info").innerText = "Проверяем сервер...";

        // Проверяем ответ с сайта
        const check = await fetch(targetUrl, { mode: 'no-cors' })
          .then(() => true)
          .catch(() => false);

        if (!check) {
          showError("Сервер недоступен. Попробуйте позже.");
          return;
        }

        // Если доступен — проверим содержимое
        const textRes = await fetch(targetUrl).then(r => r.text());
        if (textRes.includes("Cloudflare Tunnel error") || textRes.includes("Error 1033")) {
          showError("Сервер временно недоступен (ошибка Cloudflare).");
          return;
        }

        // Всё ок — перенаправляем
        document.getElementById("info").innerText = "Перенаправление...";
        setTimeout(() => window.location.href = targetUrl, 1000);
      } catch (err) {
        showError("Ошибка при подключении: " + err.message);
      }
    }

    function showError(msg) {
      document.querySelector(".loader").style.display = "none";
      document.getElementById("status").innerText = "Ошибка подключения";
      document.getElementById("status").classList.add("error");
      document.getElementById("info").innerText = msg;
    }

    checkAndRedirect();
  </script>
</body>
</html>
